name: Deploy Backend

on:
  push:
    branches: [ main, master ]
    paths:
      - 'backend/**'
      - '.github/workflows/deploy-backend.yml'
  workflow_dispatch:

jobs:
  deploy-backend:
    name: Deploy Backend to Railway/Render
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install dependencies
      working-directory: ./backend
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: Test backend
      working-directory: ./backend
      run: |
        # Tests à ajouter
        echo "Backend prêt pour déploiement"
    
    # Option 1: Déploiement sur Railway (via CLI)
    # Décommentez et configurez si vous utilisez Railway
    # - name: Install Railway CLI
    #   run: npm install -g @railway/cli
    
    # - name: Deploy to Railway
    #   env:
    #     RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
    #   run: |
    #     railway login --token $RAILWAY_TOKEN
    #     railway up --service backend
    
    # Option 2: Déploiement sur Render (via API)
    # Décommentez et configurez si vous utilisez Render
    # - name: Deploy to Render
    #   env:
    #     RENDER_API_KEY: ${{ secrets.RENDER_API_KEY }}
    #     RENDER_SERVICE_ID: ${{ secrets.RENDER_SERVICE_ID }}
    #   run: |
    #     curl -X POST "https://api.render.com/v1/services/$RENDER_SERVICE_ID/deploys" \
    #       -H "Authorization: Bearer $RENDER_API_KEY" \
    #       -H "Content-Type: application/json"
    
    - name: Build info
      run: |
        echo "Backend build terminé"
        echo "Configurez votre déploiement dans ce workflow"

